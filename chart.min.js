// pixl-chart v1.0.16 - (c) 2025 Joseph Huckaby <jhuckaby@gmail.com> - MIT License - https://github.com/jhuckaby/pixl-chart
class Chart{constructor(t={}){this.events={},this.canvas=null,this.layers=[],this.colors=["#008FFB","#00E396","#FEB019","#FF4560","#775DD0","#3F51B5","#4CAF50","#546E7A","#D4526E","#A5978B","#C7F464","#81D4FA","#2B908F","#F9A3A4","#90EE7E","#FA4443","#449DD1","#F86624","#69D2E7","#EA3546","#662E9B","#C5D86D","#D7263D","#1B998B","#2E294E","#F46036","#E2C044","#662E9B","#F86624","#F9C80E","#EA3546","#43BCCD","#5C4742","#A5978B","#8D5B4C","#5A2A27","#C4BBAF","#A300D6","#7D02EB","#5653FE","#2983FF","#00B1F2","#03A9F4","#33B2DF","#4ECDC4","#13D8AA","#FD6A6A","#F9CE1D","#FF9800"],this.background="",this.fontFamily="Helvetica, sans-serif",this.fontSize=12,this.fontColor="rgb(128, 128, 128)",this.titleSize=16,this.titleStyle="bold",this.titlePadding=15,this.title="",this.subtitle="",this.showSubtitle=!0,this.lineWidth=2,this.lineJoin="round",this.lineCap="butt",this.lineDashes=!1,this.stroke=!0,this.fill=.5,this.clip=!1,this.horizTicks=6,this.vertTicks=6,this.vertLabelPadding=10,this.vertLabelSide="left",this.horizLabelPadding=25,this.borderColor="rgba(128, 128, 128, 0.25)",this.density=window.devicePixelRatio||1,this.autoResize=!0,this.autoManage=!0,this.dataType="integer",this.dataSuffix="",this.floatPrecision=2,this.legend=!0,this.legendMaxLines=2,this.legendPadding=5,this.zeroFloor=!0,this.smoothing=!0,this.smoothingMaxSamples=200,this.smoothingMaxTotalSamples=1e3,this.hover=!0,this.hoverSort=0,this.cursor="crosshair",this.showDataGaps=!1,this.dataGapImage="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAQAAAAnOwc2AAAAAXNSR0IArs4c6QAAADRJREFUCNedyjERAEEQAsERsjpwhQUK6Z9cRvZpVxNXPQDoVXHMUsxSxdJrvwmWeixVLMUfKik183saHHcAAAAASUVORK5CYII=",this.autoHeadroom=!0,this.padding={left:0,top:0,right:10,bottom:0},this.zoom=null,this.width=0,this.height=0,this.progressive=!1,this.delta=!1,this.deltaMinValue=!1,this.divideByDelta=!1,this.flatten=null,this.dirty=!1,this.hidden=!1;var e,i=Intl.DateTimeFormat().resolvedOptions();for(e in this.locale=i.locale,this.timeZone=i.timeZone,this.dateStyles={minute:{hour:"numeric",hour12:!1,minute:"2-digit",second:"2-digit"},hour:{hour:"numeric",hour12:!0,minute:"2-digit"},day:{hour:"numeric",hour12:!0},month:{month:"short",day:"numeric"},year:{month:"short",day:"numeric"},tooltip:{year:"numeric",month:"short",day:"numeric",hour:"numeric",hour12:!0,minute:"2-digit"}},t)this[e]=t[e];this.padding.left=this.padding.left||0,this.padding.top=this.padding.top||0,this.padding.right=this.padding.right||0,this.padding.bottom=this.padding.bottom||0,this.init()}clone(t={}){var e=Object.assign({},this);return delete e.canvas,delete e.ctx,delete e.dirty,delete e.bounds,delete e.observer,delete e.events,delete e.tooltip,delete e.manager,delete e.idx,"colors"in t||(e.colors=JSON.parse(JSON.stringify(e.colors))),"dateStyles"in t||(e.dateStyles=JSON.parse(JSON.stringify(e.dateStyles))),"padding"in t||(e.padding=JSON.parse(JSON.stringify(e.padding))),new Chart(Object.assign(e,t))}init(){var t;this.layers.length&&(t=this.layers,this.layers=[],this.addLayers(t)),"string"==typeof this.canvas&&(this.canvas=document.querySelector(this.canvas)),this.ctx=this.canvas.getContext("2d"),this.cursor&&(this.canvas.style.cursor=this.cursor),this.autoResize&&this.setupObserver(),this.autoManage&&(ChartManager.inited||ChartManager.init(),ChartManager.add(this)),this.hover&&this.setupHover(),this.showDataGaps&&!this.gapPattern?this.setupDataGaps():this.ready=!0}setupObserver(){var t=this,e=!0;this.observer=new ResizeObserver(function(){e?e=!1:t.dirty=!0}),this.observer.observe(this.canvas)}addLayer(t){var e=Object.assign({},t);if(e.data=JSON.parse(JSON.stringify(t.data||[])),e.idx=this.layers.length,e.color=e.color||this.colors[e.idx%this.colors.length],e.data.length&&(Array.isArray(e.data[0])&&(e.data=e.data.map(function(t){return{x:t[0],y:t[1]}})),"string"==typeof e.data[0].x?e.data.forEach(function(t){t.x=new Date(t.x).getTime()/1e3}):9999999999<e.data[0].x&&e.data.forEach(function(t){t.x/=1e3}),(e.offsetX||e.offsetY)&&e.data.forEach(function(t){t.x+=e.offsetX||0,t.y+=e.offsetY||0}),this.delta)){for(var i=e.data.length-1;1<=i;i--)e.data[i].oy=e.data[i].y,e.data[i].y-=e.data[i-1].y,!1!==this.deltaMinValue&&e.data[i].y<this.deltaMinValue&&(e.data[i].y=this.deltaMinValue),this.divideByDelta&&(e.data[i].y/=e.data[i].x-e.data[i-1].x||1);e.data[0].oy=e.data[0].y,e.data[0].y=0,1<e.data.length&&(e.data[0].y=e.data[1].y)}this.layers.push(e),this.dirty=!0}addLayers(t){var e=this;t.forEach(function(t){e.addLayer(t)}),this.dirty=!0}addLayerSample(t,e,i){var a=this.layers[t];"string"==typeof(e=Array.isArray(e)?{x:e[0],y:e[1]}:e).x?e.x=new Date(e.x).getTime()/1e3:9999999999<e.x&&(e.x/=1e3),(a.offsetX||a.offsetY)&&(e.x+=a.offsetX||0,e.y+=a.offsetY||0),this.delta&&(e.oy=e.y,a.data.length?(t=a.data.length,e.y-=a.data[t-1].oy,!1!==this.deltaMinValue&&e.y<this.deltaMinValue&&(e.y=this.deltaMinValue),this.divideByDelta&&(e.y/=e.x-a.data[t-1].x||1)):e.y=0),a.data.push(e),i&&a.data.length>i&&a.data.shift(),this.dirty=!0}render(){this.ready&&(this.width&&this.height?(this.canvas.width=this.width*this.density,this.canvas.height=this.height*this.density):this.autoResize&&(this.canvas.width=this.canvas.offsetWidth*this.density,this.canvas.height=this.canvas.offsetHeight*this.density),this.draw(),this.redrawTooltip(),this.dirty=!1,this.emit("render"))}draw(){var t=this.padding,e=Math.ceil(this.canvas.width/this.density),i=Math.ceil(this.canvas.height/this.density);this.ctx.clearRect(0,0,e,i),this.background&&(this.ctx.save(),this.ctx.fillStyle=this.background,this.ctx.fillRect(0,0,e,i),this.ctx.restore()),this.bounds={x:0+t.left,y:0+t.top,width:e-(t.left+t.right),height:i-(t.top+t.bottom)},this.flattenLayers(),this.locateDataLimits(),this.renderTitle(),this.renderLegend(),this.renderVertAxis(),this.renderHorizAxis(),this.renderDataGaps(),this.renderData()}flattenLayers(){var t,s,o,h,l;this.flatten&&(t=this.flatten,s=t.type||"avg",o=!!this.dataType.match(/(integer|bytes|seconds|milliseconds)/),h={},"color"in t||(t.color=this.colors[0]),"fill"in t||(t.fill=.5),this.layers.forEach(function(t){t.data.forEach(function(t){h[t.x]?(h[t.x].total+=t.y,h[t.x].count++,t.y<h[t.x].min&&(h[t.x].min=t.y),t.y>h[t.x].max&&(h[t.x].max=t.y)):h[t.x]={x:t.x,total:t.y,count:1,min:t.y,max:t.y},t.label&&(h[t.x].label=t.label)})}),l=[],Object.keys(h).sort(function(t,e){return parseInt(t)-parseInt(e)}).forEach(function(t){var e=h[t],i={x:e.x};switch(e.label&&(i.label=e.label),s){case"avg":case"average":var a=e.total/e.count;o&&(a=Math.round(a)),i.y=a;break;case"total":i.y=e.total;break;case"min":case"minimum":i.y=e.min;break;case"max":case"maximum":i.y=e.max}l.push(i)}),t.idx=0,t.data=l)}locateDataLimits(){var h={xMin:null,yMin:null,xMax:null,yMax:null};if(this.flatten)for(var t,e,i=this.flatten.data,a=0,s=i.length;a<s;a++)t=i[a].x,e=i[a].y,(null===h.xMin||t<h.xMin)&&(h.xMin=t),(null===h.xMax||t>h.xMax)&&(h.xMax=t),(null===h.yMin||e<h.yMin)&&(h.yMin=e),(null===h.yMax||e>h.yMax)&&(h.yMax=e);else this.layers.forEach(function(t){if(!t.hidden)for(var e,i,a=t.data,s=0,o=a.length;s<o;s++)e=a[s].x,i=a[s].y,(null===h.xMin||e<h.xMin)&&(h.xMin=e),(null===h.xMax||e>h.xMax)&&(h.xMax=e),(null===h.yMin||i<h.yMin)&&(h.yMin=i),(null===h.yMax||i>h.yMax)&&(h.yMax=i)});if(this.zoom)for(var o in this.zoom)h[o]=this.zoom[o];this.dataLimits=h,this.zeroFloor&&(null===h.yMin||0<h.yMin)&&(h.yMin=0),h.yMax||(h.yMax=1),h.yMin==h.yMax&&h.yMin--,h.xMin&&h.xMax||(h.xMax=Math.floor(Date.now()/1e3),h.xMin=h.xMax-1),h.xMin==h.xMax&&h.xMin--,this.autoHeadroom&&this.addHeadroom(),this.minHorizScale&&h.xMax-h.xMin<this.minHorizScale&&(h.xMax=h.xMin+this.minHorizScale),this.minVertScale&&h.yMax-h.yMin<this.minVertScale&&(h.yMax=h.yMin+this.minVertScale),h.width=h.xMax-h.xMin,h.height=h.yMax-h.yMin;var l=h.xMax-h.xMin,r="",r=2764800<l?"year":172800<l?"month":43200<l?"day":120<l?"hour":"minute";this.dateRange=r}addHeadroom(){var t=this.dataLimits;if(!(t.yMax<=0))switch(this.dataType){case"bytes":t.yMax=Math.ceil(t.yMax),t.yMax<1024?(t.yMax<10?7<=t.yMax&&(t.yMax=10):(15<t.yMax&&(t.yMax=10*Math.ceil(t.yMax/10)),150<t.yMax&&(t.yMax=100*Math.ceil(t.yMax/100))),1024<t.yMax&&(t.yMax=1024)):(1536<t.yMax&&(t.yMax=1024*Math.ceil(t.yMax/1024)),15360<t.yMax&&(t.yMax=10240*Math.ceil(t.yMax/10240)),153600<t.yMax&&(t.yMax=102400*Math.ceil(t.yMax/102400)),1572864<t.yMax&&(t.yMax=1048576*Math.ceil(t.yMax/1048576)),15728640<t.yMax&&(t.yMax=10485760*Math.ceil(t.yMax/10485760)),157286400<t.yMax&&(t.yMax=104857600*Math.ceil(t.yMax/104857600)),1610612736<t.yMax&&(t.yMax=1073741824*Math.ceil(t.yMax/1073741824)),16106127360<t.yMax&&(t.yMax=10737418240*Math.ceil(t.yMax/10737418240)),161061273600<t.yMax&&(t.yMax=107374182400*Math.ceil(t.yMax/107374182400)),1649267441664<t.yMax&&(t.yMax=1099511627776*Math.ceil(t.yMax/1099511627776)));break;case"seconds":t.yMax=Math.ceil(t.yMax),t.yMax<60?(t.yMax<10?7<=t.yMax&&(t.yMax=10):15<t.yMax&&(t.yMax=10*Math.ceil(t.yMax/10)),60<t.yMax&&(t.yMax=60)):t.yMax<3600?(t.yMax=60*Math.ceil(t.yMax/60),900<t.yMax&&(t.yMax=600*Math.ceil(t.yMax/600))):t.yMax<86400?t.yMax=3600*Math.ceil(t.yMax/3600):t.yMax=86400*Math.ceil(t.yMax/86400);break;case"milliseconds":t.yMax<.1?(.015<t.yMax&&(t.yMax=Math.ceil(100*t.yMax)/100),.07<=t.yMax&&(t.yMax=.1)):t.yMax<1?(.15<t.yMax&&(t.yMax=Math.ceil(10*t.yMax)/10),.7<=t.yMax&&(t.yMax=1)):t.yMax<10?(t.yMax=Math.ceil(t.yMax),7<=t.yMax&&(t.yMax=10)):(t.yMax=Math.ceil(t.yMax),15<t.yMax&&(t.yMax=10*Math.ceil(t.yMax/10)),150<t.yMax&&(t.yMax=100*Math.ceil(t.yMax/100)),1e3<=t.yMax&&(t.yMax=1e3*Math.ceil(t.yMax/1e3),t.yMax<6e4?(t.yMax<1e4?7e3<=t.yMax&&(t.yMax=1e4):15e3<t.yMax&&(t.yMax=1e4*Math.ceil(t.yMax/1e4)),6e4<t.yMax&&(t.yMax=6e4)):t.yMax<36e5?(t.yMax=6e4*Math.ceil(t.yMax/6e4),9e5<t.yMax&&(t.yMax=6e5*Math.ceil(t.yMax/6e5))):t.yMax<864e5?t.yMax=36e5*Math.ceil(t.yMax/36e5):t.yMax=864e5*Math.ceil(t.yMax/864e5)));break;case"integer":case"float":t.yMax<.1?(.015<t.yMax&&(t.yMax=Math.ceil(100*t.yMax)/100),.07<=t.yMax&&(t.yMax=.1)):t.yMax<1?(.15<t.yMax&&(t.yMax=Math.ceil(10*t.yMax)/10),.7<=t.yMax&&(t.yMax=1)):t.yMax<10?(t.yMax=Math.ceil(t.yMax),7<=t.yMax&&(t.yMax=10)):(t.yMax=Math.ceil(t.yMax),15<t.yMax&&(t.yMax=10*Math.ceil(t.yMax/10)),150<t.yMax&&(t.yMax=100*Math.ceil(t.yMax/100)),1500<t.yMax&&(t.yMax=1e3*Math.ceil(t.yMax/1e3)),15e3<t.yMax&&(t.yMax=1e4*Math.ceil(t.yMax/1e4)),15e4<t.yMax&&(t.yMax=1e5*Math.ceil(t.yMax/1e5)),15e5<t.yMax&&(t.yMax=1e6*Math.ceil(t.yMax/1e6)),15e6<t.yMax&&(t.yMax=1e7*Math.ceil(t.yMax/1e7)),15e7<t.yMax&&(t.yMax=1e8*Math.ceil(t.yMax/1e8)))}}renderVertAxis(){var t=this.ctx,e=this.dataLimits,i=this.bounds;i.height-=this.horizLabelPadding+this.fontSize,t.save(),t.scale(this.density,this.density),t.font="normal "+this.fontSize+"px "+this.fontFamily,t.textAlign="left",t.textBaseline="middle",t.fillStyle=this.fontColor,t.strokeStyle=this.borderColor;for(var a,s=[],o=0,h=!(t.lineWidth=1),l=0;l<=this.vertTicks;l++){!(a=e.yMin+(e.yMax-e.yMin)/this.vertTicks*l)&&0<e.yMax&&e.yMin<0&&(h=!0);var r,n=this.formatDataValue(a,this.dataType,this.dataSuffix);(r=t.measureText(n)).width>o&&(o=r.width);var d=i.y+i.height-l/this.vertTicks*i.height;s.push({text:n,info:r,y:d,value:a})}!h&&0<e.yMax&&e.yMin<0&&(h=!0,a=0,(r=t.measureText(n)).width>o&&(o=r.width),d=this.getDotPos({x:0,y:a}).y,s.push({text:"",info:r,y:d,value:a}),s.sort(function(t,e){return t.value-e.value}));for(var x={},y=!1,l=0,c=s.length;l<c;l++)(f=s[l]).text in x&&(y=!0),x[f.text]=1;i.width-=o+2*this.vertLabelPadding,"left"==this.vertLabelSide&&(i.x+=o+2*this.vertLabelPadding);for(var f,l=0,c=s.length;l<c;l++)if(!(f=s[l]).value&&h?(t.lineWidth=2,t.setLineDash([4,4]),t.strokeStyle=this.fontColor):(t.lineWidth=1,t.setLineDash([]),t.strokeStyle=this.borderColor),t.beginPath(),t.moveTo(i.x,f.y),t.lineTo(i.x+i.width,f.y),t.stroke(),0==l||l==c-1||!y)switch(this.vertLabelSide){case"left":t.fillText(f.text,i.x-f.info.width-this.vertLabelPadding,f.y);break;case"right":t.fillText(f.text,i.x+i.width+this.vertLabelPadding,f.y)}t.restore()}renderHorizAxis(){var t=this.ctx,e=this.dataLimits,i=this.bounds;t.save(),t.scale(this.density,this.density),t.font="normal "+this.fontSize+"px "+this.fontFamily,t.textAlign="center",t.textBaseline="top",t.fillStyle=this.fontColor,t.strokeStyle=this.borderColor,t.lineWidth=1;var a=[],s=this.dateRange,o=0,h=this.horizTicks;"right"==this.vertLabelSide&&(o++,h++);for(var l=o;l<h;l++){var r=e.xMin+(e.xMax-e.xMin)/this.horizTicks*l,n=this.formatDate(r,s),r=i.x+l/this.horizTicks*i.width;a.push({text:n,x:r,line:!0})}switch(this.vertLabelSide){case"left":a[0].line=!1;break;case"right":a[a.length-1].line=!1}for(var l=0,d=a.length;l<d;l++){var x=a[l];x.line&&(t.beginPath(),t.moveTo(x.x,i.y),t.lineTo(x.x,i.y+i.height+8),t.stroke()),l&&x.text==a[l-1].text||t.fillText(x.text,x.x,i.y+i.height+12)}t.restore()}renderTitle(){var t=this.ctx,e=this.bounds,i=this.title;this.flatten&&this.flatten.title?i=this.flatten.title:this.flatten&&this.flatten.prefixTitle&&(i=this.flatten.prefixTitle+" "+i),i.length&&(t.save(),t.scale(this.density,this.density),t.font=this.titleStyle+" "+this.titleSize+"px "+this.fontFamily,t.textAlign="center",t.fillStyle=this.fontColor,t.textBaseline="middle",this.showSubtitle?(t.fillText(i,e.x+e.width/2,e.y+this.titlePadding),t.font="normal "+this.fontSize+"px "+this.fontFamily,t.fillText(this.getSubtitle(),e.x+e.width/2,e.y+ +this.titleSize+this.titlePadding+1)):t.fillText(i,e.x+e.width/2,e.y+this.titleSize/2+this.titlePadding),t.restore(),e.y+=this.titleSize+2*this.titlePadding,e.height-=this.titleSize+2*this.titlePadding)}getSubtitle(){var t=this.dataLimits,e="";if(this.subtitle)return this.subtitle;switch(this.dateRange){case"minute":case"hour":case"day":e=this.formatDateRange(t.xMin,t.xMax,"tooltip");break;case"month":case"year":var i=Object.assign({},this.dateStyles.tooltip);delete i.minute,delete i.hour,delete i.hour12;var a=this.formatDate(t.xMin,i),i=this.formatDate(t.xMax,i),e=a==i?a:a+" - "+i}return e}renderLegend(){var a,e,i,t,s,o,h=this,l=[],r=this.ctx,n=this.bounds;this.legend&&(this.flatten||(r.save(),r.scale(this.density,this.density),r.font="normal "+this.fontSize+"px "+this.fontFamily,r.textAlign="left",r.fillStyle=this.fontColor,r.textBaseline="middle",a=null,this.layers.forEach(function(t){var e,i;t.hidden||(i=(e=r.measureText(t.title)).width+26,(!a||a.width+i>n.width)&&(a&&l.push(a),a={width:0,items:[]}),a.width+=i,a.items.push({layer:t,title:t.title,width:i,info:e}))}),a&&l.push(a),!l.length||l.length>this.legendMaxLines?r.restore():(e=this.fontSize+4,i=Math.floor(e/2),t=l.length*e+this.legendPadding,s=0,o=n.y+n.height-t,l.forEach(function(t){s=Math.floor(n.x+n.width/2-t.width/2),t.items.forEach(function(t){r.globalAlpha="opacity"in t.layer?t.layer.opacity:1,r.fillStyle=t.layer.color,r.beginPath(),r.arc(s+i,o+i,h.fontSize/2,0,2*Math.PI),r.fill(),r.fillStyle=h.fontColor,r.fillText(t.title,s+17,o+i),s+=t.width}),o+=e}),r.restore(),n.height-=t)))}renderData(){if(this.hoverPoints={},this.dataLabels=[],this.isSmooth=!0,this.totalSamples=0,this.flatten){var t=this.flatten;return this.totalSamples+=t.data.length,(!t.smoothing&&!this.smoothing||t.data.length>this.smoothingMaxSamples)&&(this.isSmooth=!1),t.dirty=!0,this.renderOneLayer(t),void this.renderDataLabels()}for(var e=this.layers.length-1;0<=e;e--){t=this.layers[e];this.totalSamples+=t.data.length,(!t.smoothing&&!this.smoothing||t.data.length>this.smoothingMaxSamples)&&(this.isSmooth=!1),t.dirty=!0}if(this.progressive)this.layerFrameRequested||this.renderNextLayer();else{for(;this.renderOneLayer(););this.renderDataLabels()}}renderNextLayer(){this.layerFrameRequested=!1,this.layers&&(this.renderOneLayer()?(this.layerFrameRequested=!0,requestAnimationFrame(this.renderNextLayer.bind(this))):this.renderDataLabels())}renderOneLayer(t){var e=this.ctx,i=this.bounds;return!!(t=t||this.layers.filter(function(t){return t.dirty&&!t.hidden}).shift())&&(e.save(),e.scale(this.density,this.density),this.clip&&(e.beginPath(),e.rect(i.x-1,i.y-1,i.width+2,i.height+2),e.clip()),"opacity"in t&&(e.globalAlpha=t.opacity),(t.smoothing||this.smoothing)&&t.data.length<=this.smoothingMaxSamples&&this.totalSamples<=this.smoothingMaxTotalSamples?this.renderSmoothLayer(t):this.renderLayer(t),e.restore(),delete t.dirty,!0)}renderDataLabels(){var a=this,s=this.ctx,o=this.bounds;this.dataLabels&&this.dataLabels.length&&this.dataLabels.forEach(function(t){var e=t.label,i=a.getDotPos(t);s.save(),s.scale(a.density,a.density),s.font="normal "+a.fontSize+"px "+a.fontFamily,s.textAlign="center",s.textBaseline="middle",s.lineWidth=e.lineWidth||1,s.setLineDash(e.dashStyle||[2,2]),s.strokeStyle=e.strokeStyle||"rgba(128, 128, 128, 0.75)",s.beginPath(),s.moveTo(i.x,o.y),s.lineTo(i.x,o.y+o.height),s.stroke();t=s.measureText(e.text),t={width:a.fontSize+6,height:t.width+10};t.x=i.x-t.width,t.y=o.y,s.setLineDash([]),s.fillStyle=e.color,s.fillRect(t.x,t.y,t.width,t.height),s.strokeRect(t.x,t.y,t.width,t.height),s.fillStyle=e.fontColor||"white",s.translate(t.x+t.width/2,t.y+t.height/2),s.rotate(270*Math.PI/180),s.fillText(e.text,0,0),s.restore()})}renderDataGaps(){var l=this,r=this.bounds,e=this.ctx,n=-1,d=[];this.showDataGaps&&(this.flatten||(e.save(),e.scale(l.density,l.density),this.layers.forEach(function(t){if(!t.hidden){var e,i=t.data;if(!(i.length<2))for(var a=1,s=i.length;a<s;a++)e=i[a],(-1==n||e.x-i[a-1].x<n)&&(n=e.x-i[a-1].x)}}),this.layers.forEach(function(t){if(!t.hidden){var e=t.data,i=null;if(!(e.length<2))for(var a,s,o=1,h=e.length;o<h;o++)(i=e[o]).x-e[o-1].x>n&&(a=l.getDotPos(e[o-1]),s=l.getDotPos(i),d.push({x:a.x,y:r.y,width:s.x-a.x,height:r.height}))}}),d.length&&(e.fillStyle=this.gapPattern,d.forEach(function(t){e.fillRect(t.x,t.y,t.width,t.height)})),e.restore()))}getDotPos(t){return{x:this.bounds.x+(t.x-this.dataLimits.xMin)/this.dataLimits.width*this.bounds.width,y:this.bounds.y+this.bounds.height-(t.y-this.dataLimits.yMin)/this.dataLimits.height*this.bounds.height}}renderLayer(t,e){var i=this.ctx,a=t.data,s=t.color,o=this.bounds;i.lineWidth=t.lineWidth||this.lineWidth,i.lineJoin=t.lineJoin||this.lineJoin,i.lineCap=t.lineCap||this.lineCap,i.setLineDash(t.lineDashes||this.lineDashes||[]);var h=("fill"in t?t:this).fill;if(h){i.fillStyle=t.fillStyle||ChartUtils.alphaColor(s,h),i.beginPath();for(var l=null,e=0,r=a.length;e<r;e++)l=this.getDotPos(a[e]),0==e&&i.moveTo(l.x,o.y+o.height),i.lineTo(l.x,l.y),e==r-1&&i.lineTo(l.x,o.y+o.height);i.fill()}var n=("stroke"in t?t:this).stroke;n&&(i.strokeStyle=s,i.beginPath());for(var l=null,d=null,e=0,r=a.length;e<r;e++)d=a[e],l=this.getDotPos(d),n&&(0<e?i.lineTo(l.x,l.y):i.moveTo(l.x,l.y)),l.x>=o.x&&l.x<=o.x+o.width&&(this.hoverPoints[""+Math.floor(l.x)]=d.x),d.label&&(d.label.color||(d.label.color=s),this.dataLabels.push(d));n&&i.stroke()}renderSmoothLayer(t,e){var i=this.ctx,a=t.data,s=t.color,o=this.bounds,h=this.density;i.lineWidth=t.lineWidth||this.lineWidth,i.lineJoin=t.lineJoin||this.lineJoin,i.lineCap=t.lineCap||this.lineCap,i.setLineDash(t.lineDashes||this.lineDashes||[]);for(var l,r=[],n=[],d=null,e=0,x=a.length;e<x;e++)d=a[e],l=this.getDotPos(d),r.push(l.x),n.push(l.y),l.x>=o.x&&l.x<=o.x+o.width&&(this.hoverPoints[""+Math.floor(l.x)]=d.x),d.label&&(d.label.color||(d.label.color=s),this.dataLabels.push(d));var y=ChartUtils.createInterpolant(r,n),c=r[0],f=r[r.length-1],M=0,u=("fill"in t?t:this).fill;if(u){i.fillStyle=t.fillStyle||ChartUtils.alphaColor(s,u),i.beginPath(),i.moveTo(c,o.y+o.height);for(var p=c;p<=f;p+=h)M=y(p),i.lineTo(p,M);i.lineTo(f,M),i.lineTo(f,o.y+o.height),i.fill()}if(("stroke"in t?t:this).stroke){i.strokeStyle=s,i.beginPath();for(p=c;p<=f;p+=1)M=y(p),c<p?i.lineTo(p,M):i.moveTo(p,M);i.stroke()}}update(){this.dirty=!0,ChartManager.check()}setupHover(){var a=this;this.canvas.addEventListener("mouseenter",function(t){document.querySelectorAll(".pxc_tt_overlay").forEach(function(t){t.remove()});var e=a.canvas.getBoundingClientRect(),i=document.createElement("div");i.className="pxc_tt_overlay",i.style.left=Math.floor(e.left+window.scrollX)+"px",i.style.top=Math.floor(e.top+window.scrollY)+"px",i.style.width=e.width+"px",i.style.height=e.height+"px",i.style.cursor=a.cursor,document.body.appendChild(i),i.addEventListener("mousemove",function(t){a.handleHover(t),a.emit("mousemove",t)},!1),i.addEventListener("mouseleave",function(t){a.cancelHover(),i.remove(),a.emit("mouseout",t)},!1),i.addEventListener("mousedown",function(t){a.emit("mousedown",t)},!1),i.addEventListener("mouseup",function(t){a.emit("mouseup",t)},!1),i.addEventListener("click",function(t){a.emit("click",t)},!1),a.emit("mouseover",t)},!1)}redrawTooltip(){this.tooltip&&this.tooltip.lastHoverPt&&(this.tooltip.epoch=0,this.handleHover(this.tooltip.lastHoverPt))}handleHover(t){var o=this,e=this.bounds,i=t.offsetX,a=t.offsetY;if(this.bounds){if(i<e.x-1||i>=e.x+e.width+1||a<e.y||a>=e.y+e.height)return this.cancelHover();var s,h,l,r=2*e.width,n=0,d=!1;for(l in this.hoverPoints)h=this.hoverPoints[l],l=parseInt(l),(s=Math.abs(l-i))<r&&(r=s,n=l,d=h);if(!d)return this.cancelHover();if(!this.tooltip||this.tooltip.epoch!=d){var x=[];(this.flatten?[this.flatten]:this.layers).forEach(function(t,e){if(!t.hidden)for(var i,a=t.data,s=0,o=a.length;s<o;s++)(i=a[s]).x==d&&(x.push({layer:t,idx:e,row:i,value:i.y}),e=o)});var y="";y+='<div class="pxc_tt_content" style="',y+="font-family:"+this.fontFamily+";",y+="font-size:"+this.fontSize+"px;",y+="color:"+this.fontColor+";",y+="line-height:"+Math.floor(this.fontSize*(4/3))+"px;",y+='">';t=Object.assign({},this.dateStyles.tooltip);"minute"==this.dateRange&&(t.second="2-digit"),y+='<div class="pxc_tt_timestamp">',y+=this.formatDate(d,t),y+="</div>",y+='<table class="pxc_tt_table">',this.hoverSort&&x.sort(function(t,e){return-1==o.hoverSort?e.value-t.value:t.value-e.value}),x.forEach(function(t){var e=t.layer,i=t.value,a=t.row,s=o.formatDataValueForTooltip(i,o.dataType,o.dataSuffix),t=e.color,i="opacity:"+("opacity"in e?e.opacity:1)+";";a.label&&a.label.color&&a.label.tooltip&&(i+="color:"+a.label.color+";"),y+="<tr>",y+='<td><div class="pxc_tt_dot" style="background-color:'+t+"; "+i+'"></div></td>',y+='<td><div class="pxc_tt_title" style="'+i+'">'+(e.tooltipTitle||e.title)+"</div></td>",y+='<td><div class="pxc_tt_value" style="'+i+'">'+s+"</div></td>",y+="</tr>"}),y+="</table>",y+="</div>";var c=this.canvas.getBoundingClientRect();this.tooltip?this.tooltip.epoch=d:(this.tooltip={epoch:d,div:document.createElement("div"),line:document.createElement("div"),points:{}},this.tooltip.div.className="pxc_tooltip"+(this.isSmooth?" pxc_smooth":""),this.tooltip.line.className="pxc_line"+(this.isSmooth?" pxc_smooth":""),this.tooltip.div.style.cursor=this.cursor,this.tooltip.line.style.cursor=this.cursor,document.body.appendChild(this.tooltip.div),document.body.appendChild(this.tooltip.line)),this.tooltip.div.innerHTML=y;var f,t=this.tooltip.div.offsetWidth+20,t=Math.floor(c.left+window.scrollX+ +n-t);for(f in t<0&&(t=Math.floor(c.left+window.scrollX+ +n+20)),this.tooltip.div.style.left=t+"px",this.tooltip.div.style.top=Math.floor(c.top+window.scrollY+(e.y+10))+"px",this.tooltip.line.style.left=Math.floor(c.left+window.scrollX+n)+"px",this.tooltip.line.style.top=Math.floor(c.top+window.scrollY+e.y)+"px",this.tooltip.line.style.height=Math.floor(e.height)+"px",x.forEach(function(t){var e=t.layer,i=o.getDotPos({x:d,y:t.value}),t=o.tooltip.points[e.idx];t||(o.tooltip.points[e.idx]=t=document.createElement("div"),t.className="pxc_tt_point"+(o.isSmooth?" pxc_smooth":""),t.style.backgroundColor=e.color,t.style.cursor=o.cursor,t.style.width=Math.floor(8+o.lineWidth)+"px",t.style.height=Math.floor(8+o.lineWidth)+"px",t.style.borderWidth=Math.floor(o.lineWidth)+"px",e=Math.floor((8+o.lineWidth+2*o.lineWidth)/2),t.style.borderRadius=e+"px",t.style.marginLeft=Math.floor(0-e)+"px",t.style.marginTop=Math.floor(0-e)+"px",document.body.appendChild(t)),t.style.left=Math.floor(c.left+window.scrollX+i.x)+"px",t.style.top=Math.floor(c.top+window.scrollY+i.y)+"px",t._pxc_epoch=d}),this.tooltip.points){var M=this.tooltip.points[f];M._pxc_epoch!=d&&(M.remove(),delete this.tooltip.points[f])}this.tooltip.lastHoverPt={offsetX:i,offsetY:a}}}}cancelHover(){if(this.tooltip){for(var t in this.tooltip.div.remove(),this.tooltip.line.remove(),this.tooltip.points)this.tooltip.points[t].remove();delete this.tooltip}}setupDataGaps(){var t=this,e=new Image;e.onload=function(){t.ready=!0,t.gapPattern=t.ctx.createPattern(e,"repeat")},e.src=this.dataGapImage}formatDataValue(t,e,i){var a=t;switch(e){case"bytes":a=ChartUtils.getTextFromBytes(Math.floor(t),10**(this.floatPrecision-1));break;case"seconds":a=ChartUtils.getTextFromSeconds(t,!0);break;case"milliseconds":a=Math.abs(t)<1e3?Math.floor(t)+" ms":ChartUtils.getTextFromSeconds(t/1e3,!0);break;case"integer":a=1e9<=Math.abs(t)?Math.floor(t/1e9)+"B":1e6<=Math.abs(t)?Math.floor(t/1e6)+"M":1e4<=Math.abs(t)?Math.floor(t/1e3)+"K":ChartUtils.numFmt.format(Math.floor(t));break;case"string":a=t;break;default:a=""+ChartUtils.shortFloat(a,this.floatPrecision)}return i&&(a+=i),a}formatDataValueForTooltip(t,e,i){var a=t;switch(e){case"bytes":a=ChartUtils.getTextFromBytes(Math.floor(t),10**this.floatPrecision);break;case"seconds":a=ChartUtils.getTextFromSeconds(t,!1);break;case"milliseconds":a=Math.abs(t)<1e3?ChartUtils.shortFloat(a,this.floatPrecision)+" ms":ChartUtils.getTextFromSeconds(t/1e3,!1);break;case"integer":a=ChartUtils.numFmt.format(Math.floor(t));break;case"string":a=t;break;default:a=""+ChartUtils.shortFloat(a,this.floatPrecision)}return i&&(a+=i),a}formatDate(t,e){e="object"==typeof e?e:this.dateStyles[e];return e.timeZone=this.timeZone,new Date(1e3*t).toLocaleString(this.locale,e)}formatDateRange(t,e,i){i="object"==typeof i?i:this.dateStyles[i];return i.timeZone=this.timeZone,new Intl.DateTimeFormat(this.locale,i).formatRange(new Date(1e3*t),new Date(1e3*e))}isVisible(){if(this.hidden)return!1;if(!this.canvas)return!1;var t=this.canvas.getBoundingClientRect();return 0!=t.width&&(0!=t.height&&(!(t.right<0)&&(!(t.left>=window.innerWidth)&&(!(t.bottom<0)&&!(t.top>=window.innerHeight)))))}snapshot(t,e){var i=(t.format||"image/png").toLowerCase();i.match(/^\w+$/)&&(i="image/"+i),delete t.format;var a=t.quality||1;delete t.quality;var s=t.type||"blob";if(delete t.type,0==Object.keys(t).length){if("url"!=s)return void this.canvas.toBlob(function(t){e(t)},i,a);var o=this.canvas.toDataURL(i,a);return e&&e(o),o}t.autoResize=!1,t.autoManage=!1,t.hover=!1,t.progressive=!1,t.canvas=document.createElement("canvas"),t.width||(t.width=this.canvas.offsetWidth),t.height||(t.height=this.canvas.offsetHeight);var h=this.clone(t);if(h.render(),"url"==s){o=h.canvas.toDataURL(i,a);return h.destroy(),e&&e(o),o}h.canvas.toBlob(function(t){h.destroy(),e(t)},i,a)}download(t={}){var e,i;t.filename||(e=this.title,this.flatten&&this.flatten.title&&(e=this.flatten.title),i=(t.format||"png").replace(/^image\//,"").toLowerCase(),t.filename=e.replace(/[^\w\-\.]+/g,"")+"."+i);var a=t.filename;delete t.filename,t.type="blob",this.snapshot(t,function(t){var e=URL.createObjectURL(t),t=document.createElement("a");t.style.display="none",t.setAttribute("href",e),t.setAttribute("download",a),document.body.appendChild(t),t.click(),t.remove(),URL.revokeObjectURL(e)})}destroy(){this.cancelHover(),this.observer&&this.observer.disconnect(),delete this.observer,delete this.ctx,delete this.canvas,delete this.layers,delete this.dirty,delete this.layerFrameRequested,this.manager&&this.manager.remove(this),document.querySelectorAll(".pxc_tt_overlay").forEach(function(t){t.remove()})}on(t,e){t in this.events||(this.events[t]=[]),this.events[t].push(e)}off(t,e){t in this.events&&(-1<(e=this.events[t].indexOf(e))&&this.events[t].splice(e,1),0===this.events[t].length&&delete this.events[t])}emit(t,...e){t in this.events&&this.events[t].forEach(function(t){t(...e)})}}const ChartManager={charts:[],inited:!1,add(t){t.idx=this.charts.length,(t.manager=this).charts.push(t)},remove(t){this.charts.splice(t.idx,1),this.charts.forEach(function(t,e){t.idx=e})},init(){this.inited||(window.addEventListener("scroll",ChartUtils.debounce(this.check.bind(this),100),!1),window.addEventListener("resize",ChartUtils.debounce(this.check.bind(this),100),!1),setInterval(this.check.bind(this),250),this.inited=!0)},check(){var t=this.charts.filter(function(t){return t.dirty&&t.isVisible()}).shift();t&&(t.render(),requestAnimationFrame(this.check.bind(this)))}},ChartUtils={numFmt:new Intl.NumberFormat,getTextFromSeconds(t,e){var i="";t<0&&(t=-t,i="-");var a=e?"sec":"second",s=t;59<t&&(a=e?"min":"minute",59<(s=t=t/60)&&(a=e?"hr":"hour",23<(s=t=t/60)&&(a="day",s=t/24)));a=(s=s<10?Math.floor(10*s)/10:Math.floor(s))+" "+a;return 1==s||e||(a+="s"),i+a},getTextFromBytes(t,e){e=e||10;var i="";return(t=Math.floor(t))<0&&(t=-t,i="-"),1024<=t?1024<=(t=Math.floor(t/1024*e)/e)?1024<=(t=Math.floor(t/1024*e)/e)?1024<=(t=Math.floor(t/1024*e)/e)?i+(t=Math.floor(t/1024*e)/e)+" TB":i+t+" GB":i+t+" MB":i+t+" K":i+t+" B"},shortFloat(t,e){e=e||2;e=Math.pow(10,e);return(t=Math.round(parseFloat(t||0)*e)/e)==Math.round(t)&&(t+=".0"),""+t},alphaColor(t,e){var i=t.match(/(\w{2})(\w{2})(\w{2})/);return i?"rgba("+parseInt(i[1],16)+", "+parseInt(i[2],16)+", "+parseInt(i[3],16)+", "+e+")":(i=t.match(/^(\w+)\D+(\d+)\D+(\d+)\D+(\d+)/))?i[1]+"("+i[2]+", "+i[3]+", "+i[4]+", "+e+")":"rgb(0,0,0)"},debounce(i,a){var s=null,o=!1;return function(){var t=this,e=arguments;o=!!s||(i.apply(t,e),s=setTimeout(function(){s=null,o&&(i.apply(t,e),o=!1)},a),!1)}},createInterpolant(r,n){var t=r.length;if(t!=n.length)throw"Need an equal count of xs and ys.";if(0===t)return function(t){return 0};if(1===t){var e=+n[0];return function(t){return e}}for(var i=[],a=[],s=[],o=0;o<t-1;o++){var h=r[o+1]-r[o],l=n[o+1]-n[o];a.push(h),i.push(l),s.push(l/h)}var d=[s[0]];for(o=0;o<a.length-1;o++){var x,y,c,f=s[o],M=s[o+1];f*M<=0?d.push(0):(x=a[o],y=a[o+1],d.push(3*(c=x+y)/((c+y)/f+(c+x)/M)))}d.push(s[s.length-1]);var u=[],p=[];for(o=0;o<d.length-1;o++){var m=d[o],g=s[o],v=1/a[o],b=m+d[o+1]-g-g;u.push((g-m-b)*v),p.push(b*v*v)}return function(t){var e=r.length-1;if(t==r[e])return n[e];for(var i=0,a=p.length-1;i<=a;){var s=Math.floor(.5*(i+a)),o=r[s];if(o<t)i=s+1;else{if(!(t<o))return n[s];a=s-1}}var e=Math.max(0,a),h=t-r[e],l=h*h;return n[e]+d[e]*h+u[e]*l+p[e]*h*l}}};!function(){var t=document.createElement("style");t.innerHTML=".pxc_tt_overlay{position:absolute;z-index:2}.pxc_tooltip,.pxc_line,.pxc_tt_point{position:absolute;z-index:1}.pxc_smooth{transition:all .1s ease-in-out}.pxc_line{width:0;border-left:1px dashed #ccc}.pxc_tt_content{display:inline-block;background-color:rgba(255,255,255,1.0);border:1px solid #ddd;border-radius:5px;box-shadow:2px 2px 6px rgba(0,0,0,0.1)}.pxc_tt_timestamp{padding:5px 8px 4px 8px;background-color:#efefef;border-bottom:1px solid #ddd;border-top-left-radius:5px;border-top-right-radius:5px}.pxc_tt_table{margin:5px 6px 5px 6px}.pxc_tt_dot{width:10px;height:10px;border-radius:5px;margin-top:0}.pxc_tt_title{font-weight:bold}.pxc_tt_value{margin-left:10px;text-align:right}.pxc_tt_point{box-sizing:content-box !important;border-color:#fff;border-style:solid}body.dark .pxc_line{border-left:1px dashed #444}body.dark .pxc_tt_content{background-color:rgba(0,0,0,1.0);border:1px solid #333;box-shadow:none}body.dark .pxc_tt_timestamp{background-color:#222;border-bottom:1px solid #333}body.dark .pxc_tt_point{border-color:#000}",document.head.appendChild(t)}();
